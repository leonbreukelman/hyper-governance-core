{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/leonbreukelman/hyper-governance-core/schemas/process.schema.json",
  "title": "Process Standards Schema",
  "description": "JSON Schema for validating process.yaml - the Procedural Law defining workflows and roles",
  "type": "object",
  "required": ["version", "development_workflow", "roles"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version in semver format",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "last_updated": {
      "type": "string",
      "description": "Date of last update in ISO 8601 format",
      "format": "date"
    },
    "development_workflow": {
      "type": "object",
      "description": "Development workflow definition",
      "required": ["name", "stages"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the workflow"
        },
        "description": {
          "type": "string",
          "description": "Description of the workflow"
        },
        "stages": {
          "type": "array",
          "description": "Ordered stages in the workflow",
          "items": {
            "type": "object",
            "required": ["name", "order", "required"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Stage name"
              },
              "order": {
                "type": "integer",
                "description": "Order of execution (1-based)",
                "minimum": 1
              },
              "description": {
                "type": "string",
                "description": "Stage description"
              },
              "required": {
                "type": "boolean",
                "description": "Whether this stage is required"
              },
              "activities": {
                "type": "array",
                "description": "Activities in this stage",
                "items": {
                  "type": "string"
                }
              },
              "exit_criteria": {
                "type": "array",
                "description": "Criteria to exit this stage",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "roles": {
      "type": "array",
      "description": "Role definitions",
      "items": {
        "type": "object",
        "required": ["name", "description", "responsibilities"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Role name"
          },
          "description": {
            "type": "string",
            "description": "Role description"
          },
          "responsibilities": {
            "type": "array",
            "description": "List of responsibilities",
            "items": {
              "type": "string"
            }
          },
          "permissions": {
            "type": "array",
            "description": "List of permissions",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "code_review": {
      "type": "object",
      "description": "Code review process configuration",
      "properties": {
        "requirements": {
          "type": "object",
          "properties": {
            "min_approvals": {
              "type": "integer",
              "description": "Minimum required approvals",
              "minimum": 0
            },
            "required_reviewers": {
              "type": "array",
              "description": "List of required reviewer usernames",
              "items": {
                "type": "string"
              }
            },
            "dismiss_stale_reviews": {
              "type": "boolean",
              "description": "Dismiss reviews when new commits are pushed"
            },
            "require_code_owner_review": {
              "type": "boolean",
              "description": "Require code owner approval"
            }
          }
        },
        "review_checklist": {
          "type": "object",
          "description": "Review checklist by category",
          "additionalProperties": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "automation": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "tools": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "checks": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "testing": {
      "type": "object",
      "description": "Testing standards and requirements",
      "properties": {
        "frameworks": {
          "type": "array",
          "description": "Testing frameworks",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "purpose": {
                "type": "string"
              }
            }
          }
        },
        "test_types": {
          "type": "array",
          "description": "Types of tests",
          "items": {
            "type": "object",
            "required": ["name", "description", "location"],
            "properties": {
              "name": {
                "type": "string"
              },
              "description": {
                "type": "string"
              },
              "coverage_target": {
                "type": "integer",
                "minimum": 0,
                "maximum": 100
              },
              "location": {
                "type": "string"
              }
            }
          }
        },
        "requirements": {
          "type": "array",
          "description": "Testing requirements",
          "items": {
            "type": "string"
          }
        },
        "coverage": {
          "type": "object",
          "properties": {
            "minimum_threshold": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            },
            "target_threshold": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            },
            "fail_under": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            },
            "report_format": {
              "type": "string",
              "enum": ["html", "xml", "json", "text"]
            }
          }
        }
      }
    },
    "release_process": {
      "type": "object",
      "description": "Release process configuration",
      "properties": {
        "versioning": {
          "type": "object",
          "properties": {
            "scheme": {
              "type": "string",
              "description": "Versioning scheme",
              "enum": ["semver", "calver"]
            },
            "format": {
              "type": "string",
              "description": "Version format string"
            }
          }
        },
        "types": {
          "type": "array",
          "description": "Release types",
          "items": {
            "type": "object",
            "required": ["name", "when", "branch"],
            "properties": {
              "name": {
                "type": "string"
              },
              "when": {
                "type": "string"
              },
              "branch": {
                "type": "string"
              },
              "requires_approval": {
                "type": "string"
              }
            }
          }
        },
        "steps": {
          "type": "array",
          "description": "Release steps",
          "items": {
            "type": "string"
          }
        },
        "artifacts": {
          "type": "array",
          "description": "Release artifacts",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "issue_management": {
      "type": "object",
      "description": "Issue management configuration",
      "properties": {
        "labels": {
          "type": "array",
          "description": "Issue labels",
          "items": {
            "type": "object",
            "required": ["name", "color"],
            "properties": {
              "name": {
                "type": "string"
              },
              "color": {
                "type": "string",
                "pattern": "^[0-9a-fA-F]{6}$"
              },
              "description": {
                "type": "string"
              }
            }
          }
        },
        "templates": {
          "type": "array",
          "description": "Issue templates",
          "items": {
            "type": "object",
            "required": ["name", "title"],
            "properties": {
              "name": {
                "type": "string"
              },
              "title": {
                "type": "string"
              },
              "required_fields": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "communication": {
      "type": "object",
      "description": "Communication standards",
      "properties": {
        "channels": {
          "type": "array",
          "description": "Communication channels",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "purpose": {
                "type": "string"
              }
            }
          }
        },
        "guidelines": {
          "type": "array",
          "description": "Communication guidelines",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "ci_cd": {
      "type": "object",
      "description": "CI/CD configuration",
      "properties": {
        "platform": {
          "type": "string",
          "description": "CI/CD platform"
        },
        "on_pull_request": {
          "type": "array",
          "description": "Checks to run on pull requests",
          "items": {
            "type": "string"
          }
        },
        "on_main_push": {
          "type": "array",
          "description": "Checks to run on main branch push",
          "items": {
            "type": "string"
          }
        },
        "on_release": {
          "type": "array",
          "description": "Checks to run on release",
          "items": {
            "type": "string"
          }
        },
        "required_checks": {
          "type": "array",
          "description": "Required checks that must pass",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "governance_evolution": {
      "type": "object",
      "description": "Governance evolution process",
      "properties": {
        "process": {
          "type": "array",
          "description": "Steps for evolving governance",
          "items": {
            "type": "string"
          }
        },
        "versioning": {
          "type": "object",
          "description": "Versioning rules for governance changes",
          "properties": {
            "major": {
              "type": "string"
            },
            "minor": {
              "type": "string"
            },
            "patch": {
              "type": "string"
            }
          }
        },
        "notification": {
          "type": "array",
          "description": "Notification steps",
          "items": {
            "type": "string"
          }
        }
      }
    }
  }
}
